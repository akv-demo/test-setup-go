name: CI

on:
  push:
  pull_request:

  workflow_dispatch:

jobs:
  build:
    strategy:
      matrix:
        repo: [ulule/loukoum, gdm85/wolfengo]
  
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          repository: ${{ matrix.repo }}

      - name: Install Go
        uses: actions/setup-go@v4
        with:
          go-version: "1.20.x"
          cache: false

      - name: Get Go cached paths
        run: |
          echo "cache=$(go env GOCACHE)" >> $GITHUB_ENV
          echo "modcache=$(go env GOMODCACHE)" >> $GITHUB_ENV

      - name: get
        run: |
          test -d src && go get src || go get .

      - name: build
        run: |
          test -d src && go build src || go build .

      - name: stats
        run: |
          echo 'Build results size(Mb):'
          du -m -s `go env GOCACHE`
          echo 'Dependency results size(Mb):'
          du -m -s `go env MODGOCACHE`

